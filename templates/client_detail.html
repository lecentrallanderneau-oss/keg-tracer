{% extends "base.html" %}
{% block title %}{{ client.name }} — Keg Tracer{% endblock %}
{% block content %}
<h1>{{ client.name }}</h1>

<div class="card">
  <h2 style="margin-top:0">Solde</h2>
  <ul>
    <li>Fûts en stock (net) : <strong>{{ balance.total_kegs|default(0) }}</strong></li>
    <li>Consigne nette : <strong>{{ '{:,.2f}'.format((balance.total_deposit_eur|default(0)|float)) }} €</strong></li>
  </ul>
</div>

<div class="card">
  <h2 style="margin-top:0">Détail par produit</h2>
  {% set rows = balance.by_sku|default([], true) %}
  {% if rows %}
  <table>
    <thead>
      <tr><th>Produit</th><th>Contenance</th><th>Qté nette</th><th>Consigne</th></tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.product }}</td>
        <td>{{ r.size_l }} L</td>
        <td>{{ r.qty }}</td>
        <td>{{ '{:,.2f}'.format((r.deposit_eur|default(0)|float)) }} €</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">Aucun mouvement.</p>
  {% endif %}
</div>

<div class="card">
  <h2 style="margin-top:0">Historique des mouvements</h2>
  {% set tx = transactions|default([], true) %}
  {% if tx %}
  <table>
    <thead>
      <tr><th>Date</th><th>Type</th><th>Produit</th><th>L</th><th>Qté</th><th>Consigne</th><th>Doc</th></tr>
    </thead>
    <tbody>
      {% for t in tx %}
      <tr>
        <td>{{ t.date }}</td>
        <td>{{ t.type }}</td>
        <td>{{ t.product }}</td>
        <td>{{ t.size_l }}</td>
        <td>{{ t.qty }}</td>
        <td>{{ '{:,.2f}'.format((t.deposit_eur|default(0)|float)) }} €</td>
        <td>{{ t.doc_no }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">Aucun mouvement.</p>
  {% endif %}
</div>

<p style="margin-top: 16px;"><a href="/clients">← Retour à la liste</a></p>
{% endblock %}

