{% extends "base.html" %}
{% block title %}Mouvements{% endblock %}
{% block content %}

<h2>Mouvements</h2>

<a class="btn primary block" href="{{ url_for('movement_add') }}">+ Ajouter un mouvement</a>

<div class="list">
  {% for m in moves %}
  <article class="item card">
    <header class="item-head">
      <div class="pill {{ 'out' if m.mtype=='Livraison' else 'in' }}">{{ m.mtype }}</div>
      <div class="date">{{ m.dt.strftime('%d/%m/%Y') }}</div>
    </header>

    <div class="grid">
      <div>
        <div class="label">Client</div>
        <div class="value">{{ m.client.name }}</div>
      </div>
      <div>
        <div class="label">Bi√®re</div>
        <div class="value">{{ m.beer.name }} ‚Äî {{ m.beer.volume }}</div>
      </div>
      <div>
        <div class="label">Quantit√©</div>
        <div class="value">{{ m.qty }}</div>
      </div>
    </div>

    {% set beer_total = m.beer_total %}
    {% set cons_total = m.consigne_total %}
    {% set total_ttc = m.total_ttc %}

    <div class="totals">
      <div class="row">
        <span>Bi√®res TTC</span>
        <strong>{{ "%.2f"|format(beer_total) }} ‚Ç¨</strong>
      </div>
      <div class="row">
        <span>Consignes</span>
        <strong>{{ "%.2f"|format(cons_total) }} ‚Ç¨</strong>
      </div>
      <div class="row big">
        <span>Total</span>
        <strong>{{ "%.2f"|format(total_ttc) }} ‚Ç¨</strong>
      </div>
    </div>

    {% if m.notes %}
      <div class="notes">üìù {{ m.notes }}</div>
    {% endif %}

    <form method="post" action="{{ url_for('movement_delete', mid=m.id) }}" onsubmit="return confirm('Supprimer ce mouvement ?');">
      <button class="btn danger block" type="submit">Supprimer</button>
    </form>
  </article>
  {% else %}
  <p>Aucun mouvement pour le moment.</p>
  {% endfor %}
</div>

<a class="fab" href="{{ url_for('movement_add') }}" aria-label="Ajouter">Ôºã</a>

<style>
  .btn{display:inline-block;padding:12px 14px;border-radius:12px;text-decoration:none;border:1px solid #e3e3e7;background:#fff}
  .btn.block{display:block;width:100%;text-align:center}
  .btn.primary{background:#111;border-color:#111;color:#fff}
  .btn.danger{background:#ff3b30;border-color:#ff3b30;color:#fff}
  .list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
  .item .item-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 4px 14px rgba(0,0,0,.08)}
  .pill{padding:6px 10px;border-radius:999px;font-size:.85rem;color:#fff}
  .pill.out{background:#0a7cff}
  .pill.in{background:#34c759}
  .date{font-size:.9rem;color:#666}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0}
  .label{font-size:.8rem;color:#666}
  .value{font-size:1rem}
  .totals{margin-top:8px;border-top:1px dashed #eee;padding-top:8px}
  .row{display:flex;justify-content:space-between;align-items:center;padding:4px 0}
  .row.big{font-size:1.05rem}
  .notes{margin-top:8px;font-size:.95rem;background:#f7f7fb;border-radius:10px;padding:8px}
  .fab{position:fixed;right:16px;bottom:16px;background:#111;color:#fff;text-decoration:none;width:52px;height:52px;display:flex;align-items:center;justify-content:center;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,.15);font-size:24px}
  @media (min-width:720px){ .list{max-width:680px;margin:auto} }
</style>

{% endblock %}
