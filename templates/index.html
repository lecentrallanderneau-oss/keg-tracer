{% extends "base.html" %}

{% block title %}Dashboard - Keg Tracer{% endblock %}

{% block content %}
<div class="container">
  <h1>Keg Tracer Dashboard</h1>
  <p>Bienvenue sur ton application de suivi des f√ªts üç∫</p>

  <section>
    <h2>M√©triques</h2>
    <ul>
      <li>Solde consignes : {{ '{:,.2f}'.format((consigne_balance|default(0)|float)) }} ‚Ç¨</li>
      <li>F√ªts en stock : {{ total_kegs|default(0) }}</li>
      <li>Livraisons ce mois-ci : {{ deliveries_this_month|default(0) }}</li>
      <li>Retours en attente : {{ pending_returns|default(0) }}</li>
      <li>Derni√®re synchro : {{ last_sync|default('‚Äî') }}</li>
      <li>Build : {{ build_version|default('dev') }}</li>
    </ul>
  </section>

  <section>
    <h2>Derni√®res livraisons</h2>
    {% set items = recent_deliveries|default([], true) %}
    {% if items %}
      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>Date</th><th>Fournisseur</th><th>Produit</th><th>Qt√©</th><th>Consigne</th><th>Facture</th>
          </tr>
        </thead>
        <tbody>
        {% for d in items %}
          <tr>
            <td>{{ d.date|default('‚Äî') }}</td>
            <td>{{ d.supplier|default('‚Äî') }}</td>
            <td>{{ d.product|default('‚Äî') }}</td>
            <td>{{ d.quantity|default(0) }}</td>
            <td>{{ '{:,.2f}'.format((d.deposit|default(0)|float)) }} ‚Ç¨</td>
            <td>{{ d.invoice_no|default('‚Äî') }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Aucune livraison r√©cente.</p>
    {% endif %}
  </section>

  <section>
    <h2>F√ªts en circulation</h2>
    {% set k = kegs_in_circulation|default([], true) %}
    {% if k %}
      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>ID F√ªt</th><th>Produit</th><th>Contenance</th><th>Statut</th><th>Localisation</th><th>Maj</th>
          </tr>
        </thead>
        <tbody>
        {% for keg in k %}
          <tr>
            <td>{{ keg.id|default('‚Äî') }}</td>
            <td>{{ keg.product|default('‚Äî') }}</td>
            <td>{{ keg.size_l|default('‚Äî') }} L</td>
            <td>{{ keg.status|default('unknown') }}</td>
            <td>{{ keg.location|default('‚Äî') }}</td>
            <td>{{ keg.updated_at|default('‚Äî') }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Aucun f√ªt en circulation.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
